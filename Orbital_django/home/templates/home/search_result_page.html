<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
    {% include "home/tools_import_subpage.html" %}
    
    <!--JQUERY CDN-->
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.3.min.js" type="text/javascript"></script>

    <!--BOOTSTRAP CDN-->
    <!-- Latest compiled and minified CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!--layer-->
	<script src="https://cdn.bootcss.com/layer/3.0.1/layer.min.js"></script>

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    
    <!--  Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
    <link href="/static/assets/css/themify-icons.css" rel="stylesheet">

    <!--  Paper Dashboard core CSS    -->
    <link href="/static/assets/css/paper-dashboard.css" rel="stylesheet"/>

    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="/static/assets/css/demo.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="/static/assets/css/animate.min.css" rel="stylesheet"/>

    <style type="text/css">



    .button {
        background-color: #4CAF50; /* Green */
        border: none;
        color: white;
        padding: 16px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        -webkit-transition-duration: 0.4s; /* Safari */
        transition-duration: 0.4s;
        cursor: pointer;
    }
    .button2 {
        background-color: white; 
        color: #008CB0; 
        border: 2px solid #008CBA;
    }

    .button2:hover {
        background-color: #008CBA;
        color: white;
    }
    .button:after {
        content: "";
        background: #008CBA;
        display: block;
        position: absolute;
        padding-top: 300%;
        padding-left: 350%;
        margin-left: -20px!important;
        margin-top: -120%;
        opacity: 0;
        transition: all 0.8s
    }

    .button:active:after {
        padding: 0;
        margin: 0;
        opacity: 1;
        transition: 0s
    }

    </style>
</head>

<body>
<!--<form action="/handle_search" mtehod="get" class="form-inline" style="text-align: center; margin-top: 8px;">-->
<!--    <input name="search_key" type="text" class="form-control input-sm" required="required">-->
<!--    <button type="submit" class="button2">search</button>-->
<!--</form>-->
<div class="wrapper">
	<div class="sidebar" data-background-color="white" data-active-color="danger">

    <!--
		Tip 1: you can change the color of the sidebar's background using: data-background-color="white | black"
		Tip 2: you can change the color of the active button using the data-active-color="primary | info | success | warning | danger"
	-->

    	<div class="sidebar-wrapper">
            <div class="logo">
                <a href="#" class="simple-text">
                    Variorum
                </a>
            </div>

            <ul class="nav">
                <li>
                    <a href="/">
                        <i class="ti-user"></i>
                        <p>Home</p>
                    </a>
                </li>
                <li>
                    <a href=”#” onclick=(history.back())>
                        <i class="ti-back-right"></i>
                        <p>Back</p>
                    </a>
                </li>
                <li class="active">
                    <a href="">
                        <i class="ti-view-list-alt"></i>
                        <p>Result List</p>
                    </a>
                </li>
            </ul>
    	</div>
    </div>

    <div class="main-panel">
        
		<nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">Search Result of "{{ search_key }}"</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <form action="/handle_search" method="get" class="form-inline" style="display: inline">
                                <div class="input-group">
                                    <input name="search_key" type="search" class="form-control" required="required" placeholder="{{ search_key }}">
                                    <button type="submit" style="display: none"></button>
                                </div>
                            </form>
                            <a style="display: inline-block; cursor: pointer; padding-left: 8px; margin-right: 24px"><i class="ti-search"></i></a>
                            <script>
                                $(document).ready(function() {
                                    $(".ti-search").on("click", function() {
                                        var form = $(this).parents("li").find("form");
                                        form.submit();
                                    })
                                });
                            </script>
                        </li> 
                    </ul>

                </div>
            </div>
        </nav>
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Documents</h4>
                            </div>
                            <div class="content table-responsive table-full-width">
                                <table class="table table-striped">
                                    <thead>
                                        <th>ID</th>
                                        <th>Title </th>
                                    	<th>Open </th>
                                        <th>Download </th>
                                    </thead>
                                    {% for document in result_documents %} 
                                    <div id = "list-files">
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <form method="get" action="/file_viewer/" >
                                                    {% csrf_token %}
                                                    <td scope = "col">
                                                        {{ document.title }}
                                                    </td>
                                                    <td>
                                                        <button type="submit" name="document_id" value={{ document.id }} class="button2">open</button>
                                                    </td>
                                                </form>
                                                <form method="get" action="/file_viewer/download" >
                                                    {% csrf_token %}
                                                    <td><button type="submit" name="document_id" value={{ document.id }} class="button2"><i class="fa fa-cloud-download" aria-hidden="true"></i></button></td>
                                                </form>
                                            </tr>
                                      </tbody>
                                    </div>
                                    {% endfor %}
                                </table>

                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Users</h4>
                            </div>
                            <div class="content table-responsive table-full-width">
                                <table class="table table-striped">
                                    <thead>
                                        <th>ID</th>
                                        <th>Nickname </th>
                                    	<th>Relationship </th>
                                    </thead>
                                    {% for user in result_users %}
                                    <div id = "list-files">
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <form style="display: inline-block; font-family: arial; color: white">
                                                    {% csrf_token %}
                                                    <td scope = "col">
                                                        {{ user.nickname }} ({{ user.email_address }})
                                                    </td>
                                                    <td>
                                                        {% if logged_in_user in user.follower_set.all %}
                                                        <button type="button" class="button2" disabled="disabled" >Already Followed</button>
                                                        {% else %}
                                                        <button class="follow_user_button button2" type="button" name="user_id" value={{ user.id }}>Follow</button>
                                                        {% endif %}
                                                    </td>
                                                </form>
                                            </tr>
                                        </tbody>
                                    </div>
                                {% endfor %}
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Groups</h4>
                            </div>
                            <div class="content table-responsive table-full-width">
                                <table class="table table-striped">
                                    <thead>
                                        <th>ID</th>
                                        <th>Name </th>
                                    	<th>Condition </th>
                                    </thead>
                                    {% for coterie in result_coteries %}
                                    <div id = "list-files">
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <form style="display: inline-block; font-family: arial; color: white">
                                                    {% csrf_token %}
                                                    <td scope = "col">
                                                        ({{ coterie.id }}) {{ coterie.name }}
                                                    </td>
                                                    <td>
                                                        {% if logged_in_user in coterie.administrators.all %}
                                                        <button type="button" class="button2" disabled="disabled" >already administrated</button>
                                                        {% elif logged_in_user in coterie.members.all %}
                                                        <button type="button" class="button2" disabled="disabled" >already joined</button>
                                                        {% elif logged_in_user in coterie.applicants.all %}
                                                        <button type="button" class="button2" disabled="disabled" >already applied</button>       
                                                        {% else %}
                                                        <button class="apply_coterie_button button2" type="button" name="coterie_id" value={{ coterie.id }}>apply to join</button>
                                                        {% endif %}
                                                    </td>
                                                </form>
                                            </tr>
                                        </tbody>
                                    </div>
                                {% endfor %}
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        


    </div>
</div>
<footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul>

                        <li>
                            <a href="#">
                                Variorum
                            </a>
                        </li>
                    </ul>
                </nav>
				<div class="copyright pull-right">
                    &copy; <script>document.write(new Date().getFullYear())</script>, made for NUS SOC Oribital</i></a>
                </div>
            </div>
        </footer>
</body>
<!-- Paper Dashboard Core javascript and methods for Demo purpose -->
<script src="/static/assets/js/paper-dashboard.js"></script>
<script>
    var is_authenticated = {{ request.user.is_authenticated|yesno:"true,false" }};

    $(document).ready(function() {
        $(".follow_user_button").on("click", function() {
            if (is_authenticated) {
                var thisButton = $(this);
                $.ajax({
                    type: "POST",
                    url: "/user_dashboard/handle_follow_user",
                    data: {
                        csrfmiddlewaretoken: "{{ csrf_token }}",
                        user_id: thisButton.val(),
                    },
                    success: function (data) {
                        layer.msg('follow successfullly', {
                            icon: 1,
                            skin: 'layui-layer-molv', 
                            shift: 1,
                            area: ['auto', 'auto'],
                            time: 800,
                        })
                        thisButton.attr("disabled", true);
                        thisButton.text("already followed");
                    }
                })
            }
            else
                layer.msg('you need to log in to follow other users');
        })

        $(".apply_coterie_button").on("click", function() {
            if (is_authenticated) {
                var thisButton = $(this);
                $.ajax({
                    type: "POST",
                    url: "/coterie/handle_apply_coterie",
                    data: {
                        csrfmiddlewaretoken: "{{ csrf_token }}",
                        coterie_id: thisButton.val(),
                    },
                    success: function (data) {
                        layer.msg('apply successfullly', {
                            icon: 1,
                            skin: 'layui-layer-molv', 
                            shift: 1,
                            area: ['auto', 'auto'],
                            time: 800,
                        })
                        thisButton.attr("disabled", true);
                        thisButton.text("already applied");
                    }    
                })
            }
            else
                layer.msg('you need to log in to join groups');            
        })
    });
</script>
</html>